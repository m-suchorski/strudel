<body>
  <div class="container">
    <div class="count" data-start="100"></div>
    <div class="count-control">
      <button class="control-increment">+1</button>
      <button class="control-decrement">-1</button>
      <button class="control-remove">Remove</button>
    </div>

    <div class="info-container">
      <p>Number of calls for increment() function: </p><p class="counter-increment">0</p>
      <p>Number of calls for decrement() function: </p><p class="counter-decrement">0</p>
    </div>
  </div>

  <script src="../../dist/strudel.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.24.0/babel.min.js"></script>
  <script type="text/babel" data-plugins="transform-decorators-legacy">
    const { createDecorator } = Strudel;

    const CountFunctionCalls = createDecorator((component, property, ...params) => {
      let numberOfFuncCalls = 0;

      if (!component._customEvents) {
        component._customEvents = [];
      }

      const cb = function handler() {
        try {
          numberOfFuncCalls += 1;

          document.querySelector(`.counter-${property}`).innerText = numberOfFuncCalls;
        } catch (e) {
          console.log(e);
        }
      }

      component._customEvents[property] = cb; 
      component.$element.on(params[0], params[1], cb.bind(component));
    });

    @Strudel.Component('.count')
    class Count {
      init() {
        this.value = parseInt(this.$data.start, 10);
        
      	this.$on('counter.increment', function () {
      		this.value++;
      		this.render();
        }.bind(this));

        this.$on('counter.decrement', function () {
          this.value--;
          this.render();
        }.bind(this));

        this.$on('counter.teardown', function () {
          this.value = -1;
          this.render();
        }.bind(this));

        this.render();
      }

      render() {
        this.$element.html(this.value);
      }
    }
    
    @Strudel.Component('.count-control')
    class CountControl {
      @CountFunctionCalls('click', '.control-increment')
      @Strudel.Evt('click .control-increment')
      increment() {
        this.$emit('counter.increment');
      }

      @CountFunctionCalls('click', '.control-decrement')
      @Strudel.Evt('click .control-decrement')
      decrement() {
        this.$emit('counter.decrement');
      }

      @Strudel.Evt('click .control-remove')
      remove() {
        this.$element.remove();
      }
      
      destroy() {
        this.$emit('counter.teardown');
      }
    }

    Strudel.element(document).trigger('content:loaded');
  </script>
</body>