<body>
  <div class="dynamic-container"></div>
  <div class="dynamic-input-container"></div>

  <script src="../../dist/strudel.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.24.0/babel.min.js"></script>
  <script type="text/babel" data-plugins="transform-decorators-legacy">
    @Strudel.Component('.count')
    class Count {
      init() {
      	this.value = parseInt(this.$data.start, 10);

      	this.$on('counter.increment', function () {
      		this.value++;
      		this.render();
        }.bind(this));

        this.$on('counter.decrement', function () {
          this.value--;
          this.render();
        }.bind(this));

        this.$on('counter.teardown', function () {
          this.value = -1;
          this.render();
        }.bind(this));

        this.render();
      }

      render() {
        this.$element.html(this.value);
      }
    }

    @Strudel.Component('.count-control')
    class CountControl {
      @Strudel.Evt('click .control-increment')
      increment() {
        this.$emit('counter.increment');
      }

      @Strudel.Evt('click .control-decrement')
      decrement() {
        this.$emit('counter.decrement');
      }

      @Strudel.Evt('click .control-remove')
      remove() {
        this.$element.remove();
      }

      destroy() {
        this.$emit('counter.teardown');
      }
    }

    Strudel.element(document).trigger('content:loaded');

    setTimeout(() => {
      Strudel.$('.dynamic-container').append(Strudel.$(`
       <div class="count" data-start="100"></div>
       <div class="count-control">
        <button class="control-increment">+1</button>
        <button class="control-decrement">-1</button>
        <button class="control-remove">Remove</button>
       </div>
      `))
    }, 500);

    setTimeout(() => {
      Strudel.$('.dynamic-input-container').append(Strudel.$(`
        <p class="input-value"></p>
        <div class="input-container">
          <input class="input" type="text" value="test" />
          <button class="input-set">Set Value</button>
        </div>
      `))

      @Strudel.Component('.input-value')
      class InputValue {
        init() {
          this.value = 'Start';

          this.$on('input.value-changed', function (val) {
            if (val) {
              this.value = val;
              this.render();
            }
          }.bind(this))

          this.render();
        }

        render() {
          this.$element.html(this.value);
        }
      }

      @Strudel.Component('.input-container')
      class InputContainer {
        @Strudel.Evt('click .input-set')
        setValue() {
          this.$emit('input.value-changed', Strudel.$('.input').first().value);
        }
      }

      Strudel.element(document).trigger('content:loaded');
    }, 1000)

  </script>
</body>
